{% extends "base_r2.html" %}
{% load i18n %}
{% load staticfiles %}
{% load thumbnail %}
{% load leaflet_tags %}
{% block head %}
{{ block.super }}
{% leaflet_js %}
{% leaflet_css %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.js"
integrity="sha256-7BfFV/dSvQT4pGBvRAIt6JDXsehb92DQqpGUndLCPQ4=" crossorigin="anonymous"></script>
{% endblock head %}
{% block title %}{{ block.super }} :: {{show_user.get_full_name}}{% endblock %}
{% block navbar-left %}
{% include "_navbar.html" with active_link="project" %}
{% endblock %}


{% block list_of_items %}

<!-- Delete modal -->
<div class="modal fade" id="confirm-dropout" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h4 class="modal-title" id="myModalLabel">{% trans "Confirm delete" %}</h4>
		  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		</div>
		<div class="modal-body">
		  <p>{% trans "You are going to drop out ECSA membership" %}</p>
		  <p>{% trans "Are you sure?" %}</p>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Cancel" %}</button>
		  <a class="btn btn-red btn-dropout"><i class="fas fa-trash-alt"></i> {% trans "Drop out" %}</a>
		</div>
	  </div>
	</div>
  </div>


<div class="container">
	<div class="row mt-5">
		<div class="container-fluid">
			<div class="card mt-5 shadow">
				<div class="card-body">
					<div class="card-title">
						<h1>
							<img title="profile picture" class="img-fluid rounded-circle" src="{% thumbnail show_user.profile.picture|default:'default_profile.png' 140x140 crop %}">
							{{ show_user.get_full_name }}
							{% if editable %}
							<a href="{% url 'accounts:delete' %}" class="btn btn-outline btn-red float-right ml-2 mt-5"><span class="fas fa-trash-alt"></span>&nbsp;{% trans "Delete Profile" %}</a>
							<a href="{% url 'profiles:edit_self' %}" class="btn btn-outline btn-green float-right ml-2 mt-5"><i class="fas fa-edit"></i> {% trans "Edit Profile" %}</a>
							{% endif %}							
					</div>

					{% if show_user.profile.ecsa_member or show_user.profile.former_member %}					
					<a data-href="{% url 'accounts:drop_out_ecsa_membership' %}" name='dropoutECSA' data-toggle="modal" data-target="#confirm-dropout"
					 class="btn btn-outline btn-red float-right ml-2 mt-5"><i class="fas fa-users"></i> {% trans "Drop out ECSA membership" %}</a>

					{% else %}					
						{% if show_user.profile.ecsa_requested_join %}
						<a href="{% url 'accounts:claim_ecsa_payment_revision' %}" class="btn btn-outline btn-info float-right ml-2 mt-5"><i class="fas fa-users"></i> {% trans "Claim for ECSA payment revision" %}</a>					
						{% else %}
						<a href="{% url 'accounts:new_ecsa_individual_membership' %}" class="btn btn-outline btn-info float-right ml-2 mt-5"><i class="fas fa-users"></i> {% trans "Sign up for ECSA membership" %}</a>
						{% endif %}
					{% endif %}
				</div>
					

				{% if show_user.profile.ecsa_member or show_user.profile.former_member or show_user.profile.ecsa_requested_join %}
				<div class="card-header flex  flex-row-reverse">
					<ul class="nav nav nav-tabs card-header-tabs mr-auto flex-row-reverse">
						<li class="nav-item">
						<a class="nav-link sub" id="parttab" href="#"
						onClick="$('#one').hide(); $('#two').show()
						$('#parttab').addClass('active')
						$('#desctab').removeClass('active') ">{% trans "ECSA" %}</a>
						</li>
						<li class="nav-item">
						<a class="nav-link sub active" id="desctab" href="#"
						onClick="$('#two').hide(); $('#one').show();
						$('#desctab').addClass('active')
						$('#parttab').removeClass('active')">{% trans "Profile" %}</a>
						</li>
					</ul>
					</div>
					{% endif %}

				<div class="card-text" id="one">
					<div class="row p-3">
						<div class="col-12 col-sm-6">
							<p><b>{% trans "Email" %}: </b>{{ show_user.email|default:"missing"}}</p>
							<p><b>{% trans "Joined" %}: </b>{{ show_user.date_joined }}</p>
							<p><b>{% trans "Last seen" %}: </b>{{ show_user.last_login }}</p>
						</div>
						<div class="col-12 col-sm-6">
							<p><strong>{% trans "Title" %}</strong>: {{ show_user.profile.title }} </p>
							<p><strong>{% trans "Bio and disciplinary background" %}</strong>: {{ show_user.profile.bio }}</p>
							<p><strong>{% trans "ORCID profile" %}</strong>: {% if show_user.profile.orcid %} <a href="https://orcid.org/{{ show_user.profile.orcid }}" target="_blank">{{ show_user.profile.orcid }}</a>{% endif %}</p>
							<b>{% trans "Organisation" %}:</b>
							{% for organisation in show_user.profile.organisation.all %} <a class="badge" href="/organisation/{{organisation.id}}">{{organisation}}</a>  {% endfor %}
							<br/>
						</div>
						<div class="col-12 col-sm-6">
							<p><strong>{% trans "Interest Areas" %}</strong>:
								{% for area in show_user.profile.interestAreas.all %}
								{{ area }}
								{% endfor %}
							</p>
						</div>
					</div>
					<div >
						<label><strong>{% trans "Geographical location" %}</strong></label>
						{% leaflet_map "map" callback="window.map_init_basic" %}
					</div>
				</div>

				<div class="card-text myhidden" id="two">
					<div class="row p-3">
						<div class="col-12 col-sm-6">
							<p><b>{% trans "Member type" %}: </b>
							{% if show_user.profile.former_member %}
								Former member
							{% else %}
								ECSA member
							{% endif %}
							</p>
							<p><b>{% trans "Member since" %}: </b>{{ show_user.profile.ecsa_member_since | date:"d/m/Y" }}</p>
							<p><b>{% trans "Payment revision" %}: </b>{% if show_user.profile.ecsa_payment_revision %} Yes {% else %} No{% endif %}</p>
							<p><b>{% trans "Member number" %}: </b>{{ show_user.profile.ecsa_member_number }}</p>							
							<p><b>{% trans "Billing email" %}: </b>{{ show_user.profile.ecsa_billing_email }}</p>
							<p><b>{% trans "Reduced fee" %}: </b>{{ show_user.profile.ecsa_reduced_fee }}</p>
							<p><b>{% trans "Old member fee" %}: </b>{{ show_user.profile.ecsa_old_member_fee }}</p>
							<p><b>{% trans "Street" %}: </b>{{ show_user.profile.street }}</p>
							<p><b>{% trans "Postal code" %}: </b>{{ show_user.profile.postal_code }}</p>
							<p><b>{% trans "City" %}: </b>{{ show_user.profile.city }}</p>
							<p><b>{% trans "Country" %}: </b>{{ show_user.profile.country }}</p>
							<p><b>{% trans "Occupation" %}: </b>{{ show_user.profile.occupation }}</p>
						</div>							
					</div>

				</div>


			</div>
		</div>
	</div>
</div>
{% endblock list_of_items%}
{% block scripts %}


	<script type="text/javascript">
		var map;
		var marker_layer = new L.marker([50.5, 30.5]);

		function map_init_basic (leafmap, options) {
			map = leafmap;
			map.setView([{{show_user.profile.latitude}}, {{show_user.profile.longitude}}], 12)
			new L.marker([{{show_user.profile.latitude}},{{show_user.profile.longitude}}]).addTo(map);
		}

		$('#confirm-dropout').on('show.bs.modal', function(e) {
			$(this).find('.btn-dropout').attr('href', $(e.relatedTarget).data('href'));
		});

	</script>
	{% endblock scripts %}
